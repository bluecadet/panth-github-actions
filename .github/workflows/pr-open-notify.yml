name: Pull Request Open - Slack notifications
on:
  push:
  pull_request:
    types: [opened]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  SEPERATOR: "::::: DO NOT EDIT BELOW :::::"

jobs:

  init:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout code.
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref || github.ref_name }}

      # Debugger
      - uses: hmarr/debug-action@v2


      # Setup and cache node.
      - name: Use Node.js with proper version.
        uses: actions/setup-node@v4
        with:
          node-version-file: ".nvmrc"

      # Cache vendor folder
      - name: Cache vendor folder
        uses: actions/cache@v4
        env:
          cache-name: cache-vendor
        with:
          path: ./vendor
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}

      - name: run node script
        env:
          CONTEXT_GITHUB: ${{ toJson(github) }}
          GITHUB_EVENT_NAME: ${{ github.event_name }}
          GITHUB_EVENT_TYPE: ${{ github.event.type }}
        run: node ./.ci/scripts/pr-notifications.js
