name: Lighthouse Testing
on:
  push:
  workflow_dispatch:
    inputs:
      urls:
        description: URLs to test
        required: true
        type: string
        default: "https://cartermuseum.org/,https://cartermuseum.org/about"


env:
  DEFAULT_URLS: "https://cartermuseum.org/,https://cartermuseum.org/about"

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Debugger
      # - uses: hmarr/debug-action@v2


      - name: Inputs
        run: |
          echo ${{ inputs.urls }}


      - name: Generate URLs
        id: urls
        uses: actions/github-script@v6
        env:
          inputUrls: '${{inputs.urls}}'
          defaultUrls: '${{env.DEFAULT_URLS}}'
        with:
          script: |
            let urls = "";
            if (process.env.inputUrls) {
              urls = process.env.inputUrls.split(",");
            }
            else {
              urls = process.env.defaultUrls.split(",");
            }
            core.setOutput('urls', urls);

      - name: Audit URLs using Lighthouse
        id: lighthouse
        uses: treosh/lighthouse-ci-action@v9
        with:
          urls: |
            ${{ steps.urls.outputs.urls }}
          # budgetPath: ./budget.json # test performance budgets
          uploadArtifacts: true # save results as an action artifacts
          # temporaryPublicStorage: true # upload lighthouse report to the temporary storage

      # Debugger
      - uses: hmarr/debug-action@v2

      - name: Outputs
        run: |
          echo ${{ steps.lighthouse.outputs.resultsPath }}
          echo ${{ steps.lighthouse.outputs.links }}
          echo ${{ steps.lighthouse.outputs.assertionResults }}
          echo ${{ steps.lighthouse.outputs.manifest }}
